---
title: "eltoo with Anyprevout and Taproot"
subtitle: "Basic scripts and first transaction tests"
---

# Introduction

With the Taproot soft fork scheduled to be activated before the end of 2021, now is the time to look at other BIPs that have been waiting on itâ€™s activation. One in particular that was discussed during the review of Taproot is a new set of sighash flags described by BIP-118 known as SIGHASH_ANYPREVOUT (APO) and SIGHASH_ANYPREVOUTANYSCRIPT (APOAS) - previously known as SIGHASH_NOINPUT. This soft fork enables a powerful new mechanism for replacing presigned transactions in off-chain protocols. The eltoo protocol in particular describes a protocol for the Lightning network that relies on APO and APOAS. 

I summarize below the basic mechanisms and motivations of anyprevout and eltoo and describe my tests of the Bitcoin transactions needed for the eltoo protocol and how to run them. These tests use a fork of Bitcoin with an initial implementation of BIP-118.

The target audience for this write-up is anyone who wants to understand BIP-118 and eltoo better at the transaction and script level. You should also be capable of building Bitcoin Core from source and understand Python scripts. Following the steps below you will be able to see eltoo transactions confirmed on a local regtest network as a concrete example of both how eltoo and BIP-118 works. My hope is that this will allow both proposals to be better understood and increase the number of people capable of reviewing and offering suggestions. We need more people to run these tests, and create their own tests, to help find problems and improvements before BIP-118 can be adopted by the Bitcoin network and eltoo by the Lightning network

# Anyprevout

BIP-118 proposes a soft fork that allows transactions to not just spend a specific previous transaction output, but instead any transactions output that uses the same signing key, in the case of SIGHASH_ANYPREVOUTANYSCRIPT, or that spends the same amount and uses the exact same script in the case of SIGHASH_ANYPREVOUT. Use of these two sighashes are enabled only for taproot script path spends of taproot transactions that reference a public key prepended with a new public key type. Some key features of BIP-118 are summarized below.
